<div class="col-lg-12">

  <div class="contenedor-list">
    <h2 class="mt-3">Mis listas</h2>

    <div class="card border-dark bg-light card-nuevaLista">
      <div class="card-header color-negro text-white"><strong>Â¿Tienes una lista nueva?</strong></div>
      <div class="card-body text-secondary color-blanco">
        <form action="/user" method="POST">
          <div class="form-row align-items-center form-list">
            <input type="hidden" name="action" value="newList" />
            <div class="col-12 col-sm-5">
              <input type="text" id="fieldName" name="name" class="form-control form-control-sm" placeholder="Nombre de lista"
                required>
            </div>
            <div class="col-12 col-sm-5">
              <input type="text" id="fieldURL" name="url" class="form-control form-control-sm" placeholder="URL de Youtube"
                required>
            </div>
            <div class="col-sm-2 col-4 ml-auto">
              <button class="btn btn-sm btn-dark btn-square btn-block color-negro" type="submit"><strong>Aceptar</strong></button>
            </div>
          </div>
        </form>

        {{#if success}}
        <div id="alertNewList" class="alert alert-success" role="alert" style="margin: 5px;">
          Nueva lista creada
        </div>
        {{/if}}

        {{#if alert}}
        <div id="alertNewList" class="alert alert-danger" role="alert" style="margin: 5px;">
          {{alert}}
        </div>
        {{/if}}
        
      </div>
    </div>

    <div id ="divUpdateUser" class="boton-actListas mt-2 text-center">
        <button id="btnUpdateUser" class="btn btn-outline-dark btn-sm btn-square btn-block" onclick="this.blur();"><strong>Actualizar todas tus listas</strong></button>
        <div id="alertUpdateUser" class="alert alert-success text-center" role="alert" style="margin: 5px 0px; padding: 0px; display: none">Listas actualizadas</div>
        <div id="loader-animation" class="lds-ring"><div></div><div></div><div></div><div></div></div>
        <p id="loader-updateUser-comment" class="mt-2" style="display: none">Espere mientras se actualizan las listas.</p>
    </div>

    <!-- Mostrar resultados en tabla -->
    <div class="table-list mt-3">
      <table id="miTabla" class="table table-sm table-hover">
        <caption>Tabla de listas sincronizadas</caption>
        <thead class="thead-dark">
          <tr>
            <th scope="col">Nombre</th>
            <th scope="col" class="d-none d-md-table-cell">Identificador Youtube</th>
            <th scope="col" class="text-right">Incorporada</th>
            <th scope="col col-1" class="text-center">Sincroniza</th>
          </tr>
        </thead>
        <tbody>
          {{#each lists}}
          <tr>
            <th><a href="list?listid={{listId}}">{{name}}</a></th>
            <th class="d-none d-md-table-cell">{{listId}}</th>
            <th class="text-right">{{created}}</th>
            <th class ="block-sync">
              <div class={{#if sync}}"block-green" {{else}}"block-red" {{/if}}> </div>
            </th>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>

  </div>
</div>


{{!-- JAVASCRIPT --}}
<script>

  const alertNewList = document.getElementById("alertNewList");
  const fieldName = document.getElementById("fieldName");
  const fieldURL = document.getElementById("fieldURL");

  if (alertNewList != null) {
    setTimeout(function() {
      alertNewList.style.display = "none";
    }, 5000);

    fieldName.addEventListener("focus", function() {
      alertNewList.style.display = "none";
    });

    fieldURL.addEventListener("focus", function() {
      alertNewList.style.display = "none";
    });
  }

  const buttonUpdateUser = document.getElementById("btnUpdateUser");
  const alertUpdateUser = document.getElementById("alertUpdateUser");
  const loaderAnimation = document.getElementById("loader-animation");

  buttonUpdateUser.addEventListener("click", function(){
    
    buttonUpdateUser.disabled = true;
    buttonUpdateUser.innerHTML = "<strong>Espere mientras se actualizan...</strong>"
    loaderAnimation.style.display = "inline-block";

    //Buena manera de utilizarlo:
    fetch('user', {
      method: 'post',
      body: 'action=updateUser&email={{userdata.email}}',
      headers: { 'Content-type': 'application/x-www-form-urlencoded' }
    })
    .then(response => {
      if (response.ok) {
        return response.json();
      } else {
        return Promise.reject({
          status: response.status,
          statusText: response.statusText
        });
      }
    })
    .then(data => {
      if(data.success=true){
        loaderAnimation.style.display = "none";
        buttonUpdateUser.innerHTML = "<strong>Actualizar todas tus listas</strong>";
        buttonUpdateUser.disabled = false;

        alertUpdateUser.style.display = "block";
        setTimeout(function() {
          alertUpdateUser.style.display = "none";
          //buttonUpdateUser.classList.toggle("hover");
          //buttonUpdateUser.classList.toggle("active");
        }, 5000);
      }
    })
    .catch(error => console.log('error is ', error));
  });


</script>
